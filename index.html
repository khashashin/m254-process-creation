<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Prozess Beschreiben</title>
</head>

<body>
    <main class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Prozess Beschreiben</h1>
                <div class="root">

                </div>
            </div>
        </div>
    </main>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script>
        // ReactComponents
        const e = React.createElement;

        class ProcessForm extends React.Component {
            constructor(props) {
                super(props);
                this.state = {
                    processName: '',
                    activities: [{
                        "id": 1,
                        "activity": "Konzept",
                        "who": "Entwicklungsteam",
                        "what": "Konzepte von SW-Komponenten erstellen."
                    }, {
                        "id": 2,
                        "activity": "Entwicklung",
                        "who": "Entwicklungsteam",
                        "what": "Komponenten entwickeln."
                    }, {
                        "id": 3,
                        "activity": "Test",
                        "who": "Testteam",
                        "what": "Komponenten testen."
                    }, {
                        "id": 4,
                        "activity": "Veröffentlichung",
                        "who": "Entwicklungsteam",
                        "what": "Komponenten veröffentlichen."
                    }],
                };
            }

            handleChange = (event) => {
                event.preventDefault();
                event.stopPropagation();
                // export data in to file
                const data = JSON.stringify(this.state);

                const blob = new Blob([data], {
                    type: 'application/json'
                });

                const url = window.URL.createObjectURL(blob);

                const link = document.createElement('a');
                link.href = url;
                link.download = 'process.json';
                link.click();
            }

            updateActivityIndexes = () => {
                let activities = this.state.activities;
                for (let i = 0; i < activities.length; i++) {
                    activities[i].id = i + 1;
                }
                this.setState({
                    activities: activities
                });
            }

            render() {
                return e('div', {},
                    e('h1', {}, this.state.processName),
                    e('form', {},
                        e('div', {
                            className: 'form-group row'
                        },
                            e('label', {
                                htmlFor: 'processName',
                                className: 'col-sm-2 col-form-label'
                            }, 'Prozess Name'),
                            e('div', {
                                className: 'col-sm-10'
                            },
                                e('input', {
                                    type: 'text',
                                    value: this.state.processName,
                                    onChange: this.handleChange,
                                    id: 'processName',
                                    className: 'form-control',
                                })
                            )
                        ),
                        e('h4', {}, 'Aktivitäten'),
                        e('ol', {
                            className: 'list-group list-group-numbered'
                        },
                            this.state.activities.map((activity, index) => {
                                return e('li', {
                                    className: 'list-group-item',
                                    key: index
                                },
                                    e('div', {
                                        className: 'row'
                                    },
                                        e('div', {
                                            className: 'col-12 col-sm-1'
                                        },
                                            e('span', {
                                                className: 'badge badge-primary mb-2 mb-sm-0'
                                            }, index + 1)
                                        ),
                                        e('div', {
                                            className: 'col-12 col-sm-9'
                                        },
                                            e('div', {
                                                className: 'row'
                                            },
                                                e('div', {
                                                    className: 'col-12 col-sm-6 mb-2 mb-sm-0',
                                                },
                                                    e('label', {
                                                        htmlFor: 'activity',
                                                        className: 'col-form-label'
                                                    }, 'Aktivität'),
                                                    e('input', {
                                                        type: 'text',
                                                        value: activity.activity,
                                                        onChange: (event) => {
                                                            this.state.activities[index].activity = event.target.value;
                                                            this.setState({
                                                                activities: this.state.activities
                                                            });
                                                        },
                                                        style: {
                                                            width: '100%'
                                                        },
                                                        id: 'activity',
                                                    })
                                                ),
                                                e('div', {
                                                    className: 'col-12 col-sm-6 mb-2 mb-sm-0',
                                                },
                                                    e('label', {
                                                        htmlFor: 'who',
                                                        className: 'col-form-label'
                                                    }, 'Wer'),
                                                    e('input', {
                                                        type: 'text',
                                                        value: activity.who,
                                                        onChange: (event) => {
                                                            this.state.activities[index].who = event.target.value;
                                                            this.setState({
                                                                activities: this.state.activities
                                                            });
                                                        },
                                                        style: {
                                                            width: '100%'
                                                        },
                                                        id: 'who',
                                                    })
                                                ),
                                                e('div', {
                                                    className: 'col-12'
                                                },
                                                    e('label', {
                                                        htmlFor: 'what',
                                                        className: 'col-form-label'
                                                    }, 'Was'),
                                                    e('textarea', {
                                                        type: 'text',
                                                        value: activity.what,
                                                        onChange: (event) => {
                                                            this.state.activities[index].what = event.target.value;
                                                            this.setState({
                                                                activities: this.state.activities
                                                            });
                                                        },
                                                        style: {
                                                            width: '100%'
                                                        },
                                                        id: 'what',
                                                    })
                                                )
                                            )
                                        ),
                                        e('div', {
                                            className: 'col-sm-2'
                                        },
                                            e('button', {
                                                type: 'button',
                                                className: 'btn btn-danger',
                                                onClick: () => {
                                                    this.state.activities.splice(index, 1);
                                                    this.setState({
                                                        activities: this.state.activities
                                                    });
                                                    this.updateActivityIndexes();
                                                }
                                            }, 'Löschen')
                                        )
                                    )
                                );
                            })
                        ),
                        e('div', {
                            className: 'mt-2 d-flex justify-content-end flex-column flex-sm-row'
                        },
                            e('button', {
                                type: 'button',
                                className: 'btn btn-primary mb-2 mb-sm-0 mr-sm-2',
                                onClick: () => {
                                    this.state.activities.push({
                                        "id": this.state.activities.length + 1,
                                        "activity": "",
                                        "who": "",
                                        "what": ""
                                    });
                                    this.setState({
                                        activities: this.state.activities
                                    });
                                }
                            }, 'Aktivität hinzufügen'),
                            e('button', {
                                type: 'submit',
                                className: 'btn btn-success',
                                onClick: this.handleChange
                            }, 'Prozess exportieren')
                        )
                    ),
                );
            }
        }
    </script>
    <script>
        // dom ready
        document.addEventListener('DOMContentLoaded', main());

        function main() {
            const root = ReactDOM.createRoot(
                document.querySelector('.root')
            );

            root.render(
                e(ProcessForm, {})
            );
        }
    </script>
</body>

</html>
